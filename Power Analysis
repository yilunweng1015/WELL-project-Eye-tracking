library(simr)

## Load covarites
simdata0 <- read.csv("simdata.csv", header = TRUE)

## Select 2nd time window (Based on Ryskin et al.(2017), Exp2, second time window, Target Animal looking, t = 2.17)
simdata <- subset(simdata0, timewindow == 2)
simdata$cond <- as.factor(simdata$cond)

## Intercept and slopes for condition
fixed <- c(-0.17, -0.12)
## Random intercepts for participants and trial
rand <- list(0.4, 0.36)
## residual variance
res <- 2

## Linear mixed effect model
model1 <- makeLmer(talook ~ 1 + cond + (1|subject) + (1|trial), fixef=fixed, VarCorr=rand, sigma=res, data = simdata)
summary(model1)


## Specifying an Effect Size ##
fixef(model1)["condmod"] <- 2.17     # Based on Ryskin et al. (2017) Exp2, second time window, t = 2.17

## Running the Power Analysis
sim_output <- powerSim(model1, nsim=100, test = fcompare(talook~cond))
sim_output 

## Plotting
model_plot <- extend(model1, along="subject", n=60)
p_curve_ <- powerCurve(model_plot, test=fcompare(talook~cond), along="subject")
plot(p_curve)
